<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>11. 모델 queryset을 통한 CRUD - Just the Docs</title><link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2709176-10"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', "UA-2709176-10"); </script> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>모델 queryset을 통한 CRUD | Just the Docs</title><meta name="generator" content="Jekyll v3.8.5" /><meta property="og:title" content="모델 queryset을 통한 CRUD" /><meta property="og:locale" content="en_US" /><meta name="description" content="A Jekyll theme for documentation" /><meta property="og:description" content="A Jekyll theme for documentation" /><link rel="canonical" href="http://localhost:4000/docs/Django/11.%20%EB%AA%A8%EB%8D%B8%20queryset%EC%9D%84%20%ED%86%B5%ED%95%9C%20CRUD/" /><meta property="og:url" content="http://localhost:4000/docs/Django/11.%20%EB%AA%A8%EB%8D%B8%20queryset%EC%9D%84%20%ED%86%B5%ED%95%9C%20CRUD/" /><meta property="og:site_name" content="Just the Docs" /> <script type="application/ld+json"> {"@type":"WebPage","url":"http://localhost:4000/docs/Django/11.%20%EB%AA%A8%EB%8D%B8%20queryset%EC%9D%84%20%ED%86%B5%ED%95%9C%20CRUD/","headline":"모델 queryset을 통한 CRUD","description":"A Jekyll theme for documentation","@context":"https://schema.org"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"><title>Link</title><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg><div class="page-wrap"><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Just the Docs </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button></div><div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list"><li class="navigation-list-item"><a href="http://localhost:4000/" class="navigation-list-link">Home</a><li class="navigation-list-item"><a href="http://localhost:4000/docs/TIL" class="navigation-list-link">TIL</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/TIL/typography/" class="navigation-list-link">Typography</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/TIL/buttons/" class="navigation-list-link">Buttons</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/TIL/labels/" class="navigation-list-link">Labels</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/TIL/tables/" class="navigation-list-link">Tables</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/TIL/lists/" class="navigation-list-link">Lists</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/TIL/code/" class="navigation-list-link">Code</a></ul><li class="navigation-list-item"><a href="http://localhost:4000/docs/HTML" class="navigation-list-link">HTML</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/HTML/typography/" class="navigation-list-link">Typography</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/HTML/buttons/" class="navigation-list-link">Buttons</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/HTML/labels/" class="navigation-list-link">Labels</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/HTML/tables/" class="navigation-list-link">Tables</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/HTML/lists/" class="navigation-list-link">Lists</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/HTML/code/" class="navigation-list-link">Code</a></ul><li class="navigation-list-item"><a href="http://localhost:4000/docs/CSS" class="navigation-list-link">CSS</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/CSS/typography/" class="navigation-list-link">Typography</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/CSS/buttons/" class="navigation-list-link">Buttons</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/CSS/labels/" class="navigation-list-link">Labels</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/CSS/tables/" class="navigation-list-link">Tables</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/CSS/lists/" class="navigation-list-link">Lists</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/CSS/code/" class="navigation-list-link">Code</a></ul><li class="navigation-list-item"><a href="http://localhost:4000/docs/JavaScript" class="navigation-list-link">JavaScript</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/JavaScript/typography/" class="navigation-list-link">Typography</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/JavaScript/buttons/" class="navigation-list-link">Buttons</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/JavaScript/labels/" class="navigation-list-link">Labels</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/JavaScript/tables/" class="navigation-list-link">Tables</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/JavaScript/lists/" class="navigation-list-link">Lists</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/JavaScript/code/" class="navigation-list-link">Code</a></ul><li class="navigation-list-item"><a href="http://localhost:4000/docs/Python" class="navigation-list-link">Python</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/Python/typography/" class="navigation-list-link">Typography</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Python/buttons/" class="navigation-list-link">Buttons</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Python/labels/" class="navigation-list-link">Labels</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Python/tables/" class="navigation-list-link">Tables</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Python/lists/" class="navigation-list-link">Lists</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Python/code/" class="navigation-list-link">Code</a></ul><li class="navigation-list-item active"><a href="http://localhost:4000/docs/Django" class="navigation-list-link">Django</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/Django/01.%20field%EC%A0%95%EB%A6%AC/" class="navigation-list-link">01. field정리</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Django/02.%20InlineModelAdmin%20objects/" class="navigation-list-link">02. InlineModelAdmin objects</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Django/03.%20list_display,list_display_links%EC%A0%95%EB%A6%AC/" class="navigation-list-link">03. list_display,list_display_links정리</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Django/04.%20%EC%9E%A5%EA%B3%A0%20migrations%20%EC%B6%A9%EB%8F%8C%EC%8B%9C%20%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95(%ED%95%9C%EA%B3%B3%EC%9C%BC%EB%A1%9C%20%EB%AA%A8%EC%9C%BC%EB%8A%94%EA%B1%B0%20%EB%8B%A4%EC%8B%9C%20%EC%BD%94%EB%93%9C%20%ED%99%95%EC%9D%B8%ED%95%B4%EC%95%BC%ED%95%A8)/" class="navigation-list-link">04. 장고 migrations 충돌시 해결방법(한곳으로 모으는거 다시 코드 확인해야함)</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Django/05.%20path%20%ED%95%A8%EC%88%98%EC%97%90%20%EB%8C%80%ED%95%B4/" class="navigation-list-link">05. path 함수에 대해</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Django/06.%20%EC%83%88%EB%A1%9C%EC%9A%B4%20QuerySet%EC%9D%84%20%EB%B0%98%ED%99%98%ED%95%98%EB%8A%94%20%EB%A9%94%EC%86%8C%EB%93%9C/" class="navigation-list-link">06. 새로운 QuerySet을 반환하는 메소드</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Django/07.%20QuerySet%EB%A5%BC%20%EB%A6%AC%ED%84%B4%ED%95%98%EC%A7%80%20%EC%95%8A%EB%8A%94%20%EB%A9%94%EC%86%8C%EB%93%9C/" class="navigation-list-link">07. QuerySet를 리턴하지 않는 메소드</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Django/08.%20%ED%8C%8C%EC%9D%B4%EC%8D%AC%20%ED%8C%A8%ED%82%A4%EC%A7%80%20%ED%99%98%EA%B2%BD%EC%9D%84%20%EC%89%BD%EA%B2%8C%20%EA%B4%80%EB%A6%AC%ED%95%A0%20%EC%88%98%20%EC%9E%88%EB%8F%84%EB%A1%9D%20%ED%95%98%EB%8A%94%20requirements.txt/" class="navigation-list-link">08. 파이썬 패키지 환경을 쉽게 관리할 수 있도록 하는 requirements.txt</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Django/09.%20%ED%95%84%EC%9A%94%ED%95%9C%20%EB%AA%A8%EB%93%88%EC%9D%84%20%EC%9E%90%EB%8F%99%EC%9C%BC%EB%A1%9C%20import%20%ED%95%98%EA%B3%A0%20jupyter%20notebook%20%EC%8B%A4%ED%96%89/" class="navigation-list-link">09. 필요한 모듈을 자동으로 import 하고 jupyter notebook 실행</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Django/10.%20Django%20shortcut%20function/" class="navigation-list-link">10. Django shortcut function</a><li class="navigation-list-item active"><a href="http://localhost:4000/docs/Django/11.%20%EB%AA%A8%EB%8D%B8%20queryset%EC%9D%84%20%ED%86%B5%ED%95%9C%20CRUD/" class="navigation-list-link active">11. 모델 queryset을 통한 CRUD</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Django/12.%20%EB%82%B4%EC%9E%A5%20%ED%85%9C%ED%94%8C%EB%A6%BF%20%ED%83%9C%EA%B7%B8%20%EB%B0%8F%20%ED%95%84%ED%84%B0/" class="navigation-list-link">12. 내장 템플릿 태그 및 필터</a></ul><li class="navigation-list-item"><a href="http://localhost:4000/docs/Database" class="navigation-list-link">Database</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/Database/typography/" class="navigation-list-link">Typography</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Database/buttons/" class="navigation-list-link">Buttons</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Database/labels/" class="navigation-list-link">Labels</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Database/tables/" class="navigation-list-link">Tables</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Database/lists/" class="navigation-list-link">Lists</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Database/code/" class="navigation-list-link">Code</a></ul><li class="navigation-list-item"><a href="http://localhost:4000/docs/Git" class="navigation-list-link">Git</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/Git/01.%20%EA%B9%83%20%EC%98%88%EC%A0%84%20%EB%B2%84%EC%A0%84%EC%9C%BC%EB%A1%9C%20%EB%90%98%EB%8F%8C%EB%A6%AC%EB%8A%94%20%EB%B2%95/" class="navigation-list-link">01. 깃 예전 버전으로 되돌리는 법</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Git/buttons/" class="navigation-list-link">Buttons</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Git/labels/" class="navigation-list-link">Labels</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Git/tables/" class="navigation-list-link">Tables</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Git/lists/" class="navigation-list-link">Lists</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/Git/code/" class="navigation-list-link">Code</a></ul><li class="navigation-list-item"><a href="http://localhost:4000/docs/etc" class="navigation-list-link">etc</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/etc/01.%20%EA%B5%AC%EA%B8%80%20%EB%B2%88%EC%97%AD%EA%B8%B0%20%EC%82%AC%EC%9A%A9%20%EB%B0%8F%20shortcut%20%EC%A7%80%EC%A0%95%EB%B0%A9%EB%B2%95/" class="navigation-list-link">01. 구글 번역기 사용 및 shortcut 지정방법</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/etc/buttons/" class="navigation-list-link">Buttons</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/etc/labels/" class="navigation-list-link">Labels</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/etc/tables/" class="navigation-list-link">Tables</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/etc/lists/" class="navigation-list-link">Lists</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/etc/code/" class="navigation-list-link">Code</a></ul></ul></nav></div><footer class="site-footer"><p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p></footer></div><div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content"><div class="page-header js-page-header"><div class="search"><div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Just the Docs" aria-label="Search Just the Docs" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg></div><div class="js-search-results search-results-wrap"></div></div><ul class="list-style-none text-small aux-nav"><li class="d-inline-block my-0"><a href="//github.com/pmarsceill/just-the-docs">Just the Docs on GitHub</a></ul></div><div class="page"><nav class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/Django">Django</a><li class="breadcrumb-nav-list-item"><span>11. 모델 queryset을 통한 CRUD</span></ol></nav><div id="main-content" class="page-content" role="main"><h1 id="모델-queryset을-통한-crud"> <a href="#모델-queryset을-통한-crud" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 모델 queryset을 통한 CRUD</h1><p>위 문서는 아래 문서를 참조하였습니다.</p><p>https://wayhome25.github.io/django/2017/04/01/django-ep9-crud/</p><hr /><h3 id="model-manager"> <a href="#model-manager" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Model Manager</h3><ul><li><p>Model Manager</p><p>데이터베이스 질의 인터페이스를 제공</p><p>디폴트 Manager로서 모델클래스.objects가 제공된다.</p></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Post 모델의 기본 모델 매니저
$ Post.objects
&lt;django.db.models.manager.Manager at 0x7f30a4982f90&gt;
</code></pre></div></div><p><br /></p><ul><li>Model Manager를 통해 해당 모델 클래스의 DB 데이터를 추가, 조회, 수정, 삭제 (CRUD)가 가능하다.</ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ModelCls.objects.all() # 특정 모델의 전체 데이터 조회 
ModelCls.objects.all().order_by('-id')[:10] # 특정 모델의 최근 10개 데이터 조회
ModelCls.objects.create(title="New Title") # 특정 모델의 새 Row 저장
</code></pre></div></div><hr /><p>QuerySet</p><ul><li>SQL을 생성해주는 인터페이스<li>queryset을 통하여 별도의 SQL을 작성할 필요 없이 DB로 부터 데이터를 가져오고 추가, 수정, 삭제가 가능하다.<li>Model Manager를 통해 해당 Model에 대한 QuerySet을 획득한다.<ul><li>Post.objects.all() : “SELECT * FROM post…” 와 같은 SQL문 생성<li>Posb.objects.create() : “INSERT INTO post VALUES(…)” 와 같은 SQL문 생성</ul><li>Chaining을 지원한다.<li>connection 모듈을 통해 queryset으로 만들어진 실제 sql문을 shell에서 확인할 수 있다.</ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span>

<span class="n">ModelCls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-id'</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">connection</span><span class="o">.</span><span class="n">queryies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div><hr /><h1 id="db-데이터-조회-retrieve"> <a href="#db-데이터-조회-retrieve" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> DB 데이터 조회 (Retrieve)</h1><h3 id="and-조건-filter"> <a href="#and-조건-filter" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> AND 조건 (filter)</h3><p><br /></p><ul><li>chaning, Lazy</ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># chaining을 통해 조건1~3 이 적용된 queryset을 마지막에 리턴
</span><span class="n">queryset</span> <span class="o">=</span> <span class="err">모델클래스명</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
<span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="err">조건필드</span><span class="mi">1</span><span class="o">=</span><span class="err">조건값</span><span class="mi">1</span><span class="p">,</span> <span class="err">조건필드</span><span class="mi">2</span><span class="o">=</span><span class="err">조건값</span><span class="mi">2</span><span class="p">)</span>
<span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="err">조건필드</span><span class="mi">3</span><span class="o">=</span><span class="err">조건값</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">model_instance</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="n">model_instance</span><span class="p">)</span> <span class="c1"># 화면에 출력할 때 DB에 쿼리 (lazy)
</span></code></pre></div></div><p><br /></p><ul><li>i = ignore_case (대소문자 구별 X) []</ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 필터링 (qs1 = qs2)
</span><span class="n">qs1</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">title_icontains</span><span class="o">=</span><span class="s">'1'</span><span class="p">,</span> <span class="n">title_endswith</span><span class="o">=</span><span class="s">'3'</span><span class="p">)</span> <span class="c1"># i = ignore_case(대소문자 구별 X)
</span><span class="n">qs2</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">title_icontains</span><span class="o">=</span><span class="s">'1'</span><span class="p">)</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">title_endswith</span><span class="o">=</span><span class="s">'3'</span><span class="p">)</span> <span class="c1"># 체이닝
</span></code></pre></div></div><p><br /></p><h3 id="제외조건exclude"> <a href="#제외조건exclude" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 제외조건(exclude)</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 제목에 '테스트'를 포함한 record를 제외한 전체
</span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">title__icontains</span><span class="o">=</span><span class="s">'test'</span><span class="p">)</span>

<span class="c1"># 제목에 1을 포함하지만 3으로 끝나지 않는 record
</span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">title__icontains</span><span class="o">=</span><span class="s">'1'</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">title__endswith</span><span class="o">=</span><span class="s">'3'</span><span class="p">)</span>
</code></pre></div></div><p><br /></p><h3 id="or-조건filter"> <a href="#or-조건filter" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> OR 조건(filter)</h3><ul><li>Complex lookups with Q objects : or 조건을 사용하기 위해서는 Q 객체 import가 필요하다.</ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>

<span class="err">모델클래스명</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="err">조건필드</span><span class="mi">1</span><span class="o">=</span><span class="err">조건값</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="err">조건필드</span><span class="mi">2</span><span class="o">=</span><span class="err">조건값</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># or 조건
</span><span class="err">모델클래스명</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="err">조건필드</span><span class="mi">1</span><span class="o">=</span><span class="err">조건값</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Q</span><span class="p">(</span><span class="err">조건필드</span><span class="mi">2</span><span class="o">=</span><span class="err">조건값</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># and 조건
</span></code></pre></div></div><p><br /></p><h3 id="filter을-활용한-간단-검색-구현"> <a href="#filter을-활용한-간단-검색-구현" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> filter을 활용한 간단 검색 구현</h3><ul><li>포스팅 1000개 한꺼번에 만들기</ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">random</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">[</span><span class="s">'d'</span><span class="p">,</span> <span class="s">'p'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">])</span>
    <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="s">'몽키'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">"제목 #{}"</span><span class="o">.</span><span class="n">fortmat</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">content</span><span class="o">=</span><span class="s">"테스트 내용 #{}"</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>
    
<span class="c1"># 모델 클래스의 오브젝트 갯수확인
</span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</code></pre></div></div><p><br /></p><ul><li>filter를 통한 검색 구현</ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># myapp/views.py
</span><span class="k">def</span> <span class="nf">post_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'q'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">title__icontains</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/post_list.html'</span><span class="p">,</span> <span class="p">{</span>
        <span class="s">'post_list'</span><span class="p">:</span> <span class="n">qs</span><span class="p">,</span>
    <span class="p">})</span>

<span class="c1"># blog/templates/blog/post_list.html
</span><span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s">""</span> <span class="n">method</span><span class="o">=</span><span class="s">"get"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s">"text"</span> <span class="n">name</span><span class="o">=</span><span class="s">"q"</span> <span class="o">/&gt;&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="n">value</span><span class="o">=</span><span class="s">"검색"</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>

</code></pre></div></div><p><br /></p><h3 id="특정필드-기준-정렬조건metaordering"> <a href="#특정필드-기준-정렬조건metaordering" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 특정필드 기준 정렬조건(Meta.ordering)</h3><p><br /></p><ul><li>queryset의 기본 정렬은 모델 클래스 내부의 Meta.ordering 설정을 따른다.</ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># myapp/models.py
</span><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span>
	<span class="o">...</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">'-id'</span><span class="p">]</span> <span class="c1"># id 필드 기준 내림차순 정렬, 미지정시 임의 정렬       
</span>
</code></pre></div></div><p><br /></p><ul><li>모델 Meta.ordering을 무시하고 직접 정렬조건 지정도 가능하다.</ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'field1'</span><span class="p">)</span> <span class="c1"># 지정 필드 오름차순 요청
</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-field1'</span><span class="p">)</span> <span class="c1"># 지정 필드 내림차순 요청
</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'field2'</span><span class="p">,</span> <span class="s">'field3'</span><span class="p">)</span> <span class="c1"># 1차기준, 2차기준
</span>
</code></pre></div></div><p><br /></p><h3 id="범위-조건슬라이싱"> <a href="#범위-조건슬라이싱" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 범위 조건(슬라이싱)</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1"># 현재 queryset에서 처음10개만 가져오는 조건을 추가한 queryset
</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>

<span class="c1"># 현재 queryset에서 처음10번째부터 20번째까지를 가져오는 조건을 추가한 queryset 
</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span> 

<span class="c1"># 리스트 슬라이싱과 거의 유사하나, 역순 슬라이싱은 지원하지 않음
</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span> <span class="c1"># AssertionError 예외 발생
</span>
<span class="c1"># 이때는 먼저 특정 필드 기준으로 내림차순 정렬을 먼저 수행한 뒤, 슬라이싱
</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-id'</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>

</code></pre></div></div><p><br /></p><h3 id="지정-조건get-first-last"> <a href="#지정-조건get-first-last" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 지정 조건(get, first, last)</h3><ul><li>지정 조건으로 DB로부터 데이터 Fetch</ul><h3 id="querysetget"> <a href="#querysetget" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> queryset.get</h3><ul><li>해당 조건에 해당하는 데이터가 1개임을 기대<ul><li>0개 : 모델클래스명.DoesNotExist 예외 발생<li>1개 : 정상처리<li>2개 : 모델클래스명.MultipleObjectsReturned 예외 발생</ul></ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 지정 조건의 데이터 Row를 순회
</span><span class="k">for</span> <span class="n">model_instatnce</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="n">model_instance</span><span class="p">)</span>
	
<span class="c1"># 특정 조건의 데이터 Row 1개 Fetch
</span><span class="n">model_instance</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">'my title'</span><span class="p">)</span>

</code></pre></div></div><p><br /></p><h3 id="querysetfirst-querysetlast"> <a href="#querysetfirst-querysetlast" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> queryset.first(), queryset.last()</h3><ul><li>지정 조건 내에서 첫번째/마지막 데이터 Row를 Fetch<li>지정 조건에 맞는 데이터 Row가 없더라도, DoesNotExist 예외가 발생하지 않고, None을 반환</ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model_instance</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="c1"># model instance 또는 None
</span><span class="n">model_instance</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">last</span><span class="p">()</span> <span class="c1"># model instance 또는 None
</span>
</code></pre></div></div><hr /><h3 id="db-데이터-추가-create"> <a href="#db-데이터-추가-create" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> DB 데이터 추가 (Create)</h3><p><br /></p><ul><li><p>추가시에 필수필드 (필드 정의 시에, blank=True, null=True 혹은 디폴트 값이 지정되지 않은 필드)를 모두 지정해야한다.</p><p>IntegrityError 발생</p></ul><p><br /></p><ul><li>shell에서 <code class="language-plaintext highlighter-rouge">모델명</code> 을 통해서 해당 모델의 상세 필드옵션을 확인할 수 있다.</ul><p><br /></p><h3 id="방법1-각-model-instance-의-save-함수를-통해-저장"> <a href="#방법1-각-model-instance-의-save-함수를-통해-저장" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 방법1. 각 Model Instance 의 save 함수를 통해 저장</h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>model_instance = Post(author=user.objects.all()[0], title='title', text='content')
model_instance.save()

</code></pre></div></div><p><br /></p><h3 id="방법2-각-model-manager의-create-함수를-통해-저장"> <a href="#방법2-각-model-manager의-create-함수를-통해-저장" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 방법2. 각 Model Manager의 create 함수를 통해 저장</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">new_post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s">'title'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">'content'</span><span class="p">)</span>

</code></pre></div></div><hr /><h3 id="db-데이터-수정-update"> <a href="#db-데이터-수정-update" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> DB 데이터 수정 (Update)</h3><p><br /></p><h3 id="방법1-각-model-instance-의-save-함수를-통해-저장-1"> <a href="#방법1-각-model-instance-의-save-함수를-통해-저장-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 방법1. 각 Model Instance 의 save 함수를 통해 저장</h3><ul><li>각 Model 인스턴스 별로 SQL 수행<li>다수 Row에 대해서 수행 시 성능저하</ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>post_instance = Post.objects.get(id=66)
post_instance.title = 'edit title' # title 수정
post_instance.save()

queryset = Post.objects.all()
for post in queryset:
	post.tags = 'Python, Django'
	post.save() # 각 Model Instance 별로 DB에 update 요청 - 성능저하

</code></pre></div></div><p><br /></p><h3 id="방법2-queryset의-update-함수에-업데이트할-속성값을-지정하여-일괄-수정"> <a href="#방법2-queryset의-update-함수에-업데이트할-속성값을-지정하여-일괄-수정" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 방법2. QuerySet의 update 함수에 업데이트할 속성값을 지정하여 일괄 수정</h3><ul><li>하나의 SQL 로서 동작하므로, 동작이 빠르다.</ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">queryset</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
<span class="n">queryset</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">'test title'</span><span class="p">)</span> <span class="c1"># 일괄 update 요청
</span>
</code></pre></div></div><hr /><h3 id="db-데이터-삭제delete"> <a href="#db-데이터-삭제delete" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> DB 데이터 삭제(Delete)</h3><p><br /></p><h3 id="방법1-각-model-instance의-delete-함수를-호출하여-삭제"> <a href="#방법1-각-model-instance의-delete-함수를-호출하여-삭제" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 방법1. 각 Model Instance의 delete 함수를 호출하여 삭제</h3><ul><li>각 Model인스턴스 별로 SQL 수행<li>다수 Row에 대해서 수행 시 성능저하</ul><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">post_instance</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">66</span><span class="p">)</span>
<span class="n">post_instance</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

<span class="n">queryset</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
        <span class="n">post</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span> <span class="c1"># 각 Model Instance 별로 DB에 delete 요청 - 성능저하
</span>
</code></pre></div></div><p><br /></p><h3 id="방법2-queryset의-delete-함수를-호출하여-관련-데이터를-삭제"> <a href="#방법2-queryset의-delete-함수를-호출하여-관련-데이터를-삭제" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 방법2. QuerySet의 delete 함수를 호출하여, 관련 데이터를 삭제</h3><ul><li>하나의 SQL로 동작하므로 동작이 빠르다.</ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>queryset = Post.objects.all()
queryset.delete() # 일괄 delete 요청

</code></pre></div></div><hr><footer role="contentinfo"><p class="text-small text-grey-dk-000 mb-0">Copyright &copy; 2017-2019 Patrick Marsceill. Distributed by an <a href="https://github.com/pmarsceill/just-the-docs/tree/master/LICENSE.txt">MIT license.</a></p></footer></div></div></div></div>
